<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.PageDao">

	<select id="selectAll" resultType="Page">
		select p.*
		  from page p
		  left join (select id, id as lv1_id, 0 as lv2_id, 0 as lv3_id from page where level = 1
		             union
		             select id, parent_id as lv1_id, id as lv2_id, 0 as lv3_id from page where level = 2
		             union
		             select p3.id, p3p.parent_id as lv1_id, p3p.id as lv2_id, p3.id as lv3_id
		               from page p3
		               left join page p3p
		                 on p3p.id = p3.parent_id
		               where p3.level = 3) plv
		    on plv.id = p.id
		 order by plv.lv1_id, plv.lv2_id, plv.lv3_id
	</select>

	<select id="selectByPrimaryKey" resultType="Page">
		select * from page where id = #{id}
	</select>

	<insert id="insert" parameterType="Page" useGeneratedKeys="true" keyProperty="id">
		insert into page
		(
			parent_id
			,level
			,title
			,content
		)
		values
		(
			#{parentId}
			,#{level}
			,#{title}
			,#{content}
		)
	</insert>

	<update id="update" parameterType="Page">
		update page
		set
			title = #{title}
			,content = #{content}
		where
			id = #{id}
	</update>

</mapper>
